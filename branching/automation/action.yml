name: 'Scaled Git Branching Model automation'
description: 'Automates aspects of the Scaled Git Branching Model'
inputs: {}
outputs: {}
runs:
  using: 'composite'
  steps:
    - name: 'Determine state'
      shell: pwsh
      if: ${{ github.event_name == 'pull_request' }}
      env:
        HEAD_REF: ${{ github.head_ref }}
        BASE_REF: ${{ github.base_ref }}
      run: |
        git tool-config
        Write-Host "Head: $($env:HEAD_REF) --> Base: $($env:BASE_REF)"
        [string[]] $dependencies = git show-deps -target $($env:HEAD_REF) -noFetch -quiet
        [string[]] $allDependencies = git show-deps -target $($env:HEAD_REF) -noFetch -quiet -recurse
        [string[]] $dependants = git show-dependants -target $($env:HEAD_REF) -noFetch -quiet
        [string[]] $allDependants = git show-dependants -target $($env:HEAD_REF) -noFetch -quiet -recurse
        @{ dependencies = $dependencies; allDependencies = $allDependencies; dependants = $dependants; allDependants = $allDependants } | ConvertTo-Json | Write-Host
